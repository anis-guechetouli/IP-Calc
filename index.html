<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Calc - Calculateur Réseau Moderne</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1', // Indigo 500
                        secondary: '#8b5cf6', // Violet 500
                        dark: '#0f172a', // Slate 900
                        card: '#1e293b', // Slate 800
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Fira Code', monospace; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 dark:bg-dark dark:text-gray-200 transition-colors duration-300 min-h-screen flex flex-col">

    <!-- CONFIGURATION -->
    <script>
        const GITHUB_URL = "https://github.com/anis-guechetouli/IP-Calc.git";
    </script>

    <!-- NAVBAR -->
    <nav class="sticky top-0 z-50 backdrop-blur-lg bg-white/80 dark:bg-dark/80 border-b border-gray-200 dark:border-slate-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Logo -->
                <a href="index.html" class="flex items-center gap-2 group">
                    <svg class="w-8 h-8 text-primary group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    <span class="font-bold text-xl tracking-tight text-slate-900 dark:text-white">IP <span class="text-primary">Calc</span></span>
                </a>

                <!-- Links -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-primary font-semibold">Accueil</a>
                    <a href="about.html" class="text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors">À propos</a>
                    <a href="#" onclick="window.open(GITHUB_URL, '_blank')" class="text-gray-600 dark:text-gray-400 hover:text-black dark:hover:text-white transition-colors">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                    </a>
                    <!-- Dark Mode Toggle -->
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors">
                        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 w-full">
        
        <!-- Tabs Navigation -->
        <div class="flex justify-center mb-8">
            <div class="bg-white dark:bg-card p-1 rounded-lg shadow-sm border border-gray-200 dark:border-slate-700 inline-flex">
                <button onclick="switchTab('calc')" id="btn-tab-calc" class="px-6 py-2 rounded-md text-sm font-semibold bg-primary text-white shadow-sm transition-all">Calculateur IP</button>
                <button onclick="switchTab('vlan')" id="btn-tab-vlan" class="px-6 py-2 rounded-md text-sm font-semibold text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-white transition-all">VLAN Planner</button>
            </div>
        </div>

        <!-- TAB 1: CALCULATOR -->
        <div id="tab-calc">
            <!-- Input Section -->
            <div class="bg-white dark:bg-card rounded-2xl shadow-xl p-6 mb-8 border border-gray-100 dark:border-slate-700">
                <h1 class="text-2xl font-bold mb-6 text-center">Calculateur de Sous-Réseau</h1>
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full md:w-2/3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Adresse IP (IPv4 ou IPv6)</label>
                        <input type="text" id="ipInput" placeholder="ex: 192.168.1.10 ou 192.168.1.10/24" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all font-mono">
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Masque / CIDR</label>
                        <select id="cidrSelect" onchange="calculate()" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none font-mono">
                            <!-- Options générées par JS -->
                        </select>
                    </div>
                    <button onclick="calculate()" class="w-full md:w-auto px-8 py-3 bg-gradient-to-r from-primary to-secondary hover:from-indigo-600 hover:to-violet-600 text-white font-bold rounded-lg shadow-lg transform hover:-translate-y-0.5 transition-all">
                        Calculer
                    </button>
                </div>
                <p id="errorMsg" class="text-red-500 text-sm mt-2 hidden"></p>
            </div>

            <!-- Results Grid -->
            <div id="resultsArea" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Card 1: Network Info -->
                <div class="bg-white dark:bg-card rounded-xl shadow-md p-5 border-l-4 border-primary hover:shadow-lg transition-shadow">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                        Réseau
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Adresse IP</span>
                            <span class="font-mono font-bold select-all" id="resIp"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Masque</span>
                            <span class="font-mono select-all" id="resMask"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Adresse Réseau</span>
                            <span class="font-mono text-primary font-bold select-all" id="resNetId"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Broadcast</span>
                            <span class="font-mono text-secondary font-bold select-all" id="resBroadcast"></span>
                        </div>
                        <div class="flex justify-between pt-1">
                            <span class="text-gray-500 dark:text-gray-400">Wildcard (Cisco)</span>
                            <span class="font-mono select-all" id="resWildcard"></span>
                        </div>
                    </div>
                </div>

                <!-- Card 2: Hosts & Range -->
                <div class="bg-white dark:bg-card rounded-xl shadow-md p-5 border-l-4 border-secondary hover:shadow-lg transition-shadow">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                        Hôtes & Plage
                    </h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Hôtes Utilisables</span>
                            <span class="font-mono font-bold" id="resHosts"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Total Adresses</span>
                            <span class="font-mono" id="resTotal"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Première IP</span>
                            <span class="font-mono select-all" id="resFirst"></span>
                        </div>
                        <div class="flex justify-between border-b dark:border-slate-700 pb-1">
                            <span class="text-gray-500 dark:text-gray-400">Dernière IP</span>
                            <span class="font-mono select-all" id="resLast"></span>
                        </div>
                        <div class="flex justify-between pt-1">
                            <span class="text-gray-500 dark:text-gray-400">Classe</span>
                            <span class="font-mono" id="resClass"></span>
                        </div>
                    </div>
                </div>

                <!-- Card 3: Binary & Details -->
                <div class="bg-white dark:bg-card rounded-xl shadow-md p-5 border-l-4 border-pink-500 hover:shadow-lg transition-shadow md:col-span-2 lg:col-span-1">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
                        Binaire & Routage
                    </h3>
                    <div class="space-y-2 text-xs font-mono overflow-x-auto">
                        <div>
                            <span class="text-gray-500 block mb-1">IP Binaire</span>
                            <span class="text-primary" id="binIp"></span>
                        </div>
                        <div>
                            <span class="text-gray-500 block mb-1">Masque Binaire</span>
                            <span class="text-gray-400" id="binMask"></span>
                        </div>
                        <div class="border-t dark:border-slate-700 my-2 pt-2">
                            <span class="text-gray-500 block mb-1 font-sans text-sm">Reverse DNS (PTR)</span>
                            <span class="text-secondary select-all" id="resPtr"></span>
                        </div>
                        <div>
                            <span class="text-gray-500 block mb-1 font-sans text-sm">Type d'IP</span>
                            <span class="bg-gray-100 dark:bg-slate-700 px-2 py-1 rounded text-xs" id="resType"></span>
                        </div>
                    </div>
                </div>

                <!-- Card 4: OSINT (Optional) -->
                <div id="osintCard" class="hidden bg-white dark:bg-card rounded-xl shadow-md p-5 border-l-4 border-emerald-500 hover:shadow-lg transition-shadow md:col-span-2 lg:col-span-3">
                    <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <svg class="w-5 h-5 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Infos Publiques (OSINT)
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm" id="osintContent">
                        <!-- Rempli par JS -->
                        <div class="animate-pulse bg-gray-200 h-4 w-full rounded"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: VLAN PLANNER -->
        <div id="tab-vlan" class="hidden">
            <div class="bg-white dark:bg-card rounded-2xl shadow-xl p-6 mb-8 border border-gray-100 dark:border-slate-700">
                <h2 class="text-2xl font-bold mb-6 text-center">Planificateur VLAN (FLSM)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Réseau de base (CIDR)</label>
                        <input type="text" id="vlanBase" placeholder="ex: 192.168.10.0/24" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none font-mono">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Mode de calcul</label>
                        <select id="vlanMode" onchange="toggleVlanInputs()" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none">
                            <option value="count">Nombre de VLANs</option>
                            <option value="hosts">Hôtes par VLAN</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nombre de VLANs</label>
                        <input type="number" id="vlanCount" min="1" value="4" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                    <div id="divVlanHosts" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Hôtes par VLAN</label>
                        <input type="number" id="vlanHosts" min="1" value="20" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none">
                    </div>
                </div>
                <div class="mb-6">
                     <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">IDs VLAN (Optionnel, CSV)</label>
                     <input type="text" id="vlanIds" placeholder="ex: 10, 20, 30, 40 (laisser vide pour auto)" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-slate-600 bg-gray-50 dark:bg-slate-900 focus:ring-2 focus:ring-primary outline-none font-mono">
                </div>
                <button onclick="calculateVLAN()" class="w-full px-8 py-3 bg-gradient-to-r from-primary to-secondary hover:from-indigo-600 hover:to-violet-600 text-white font-bold rounded-lg shadow-lg transform hover:-translate-y-0.5 transition-all">
                    Générer le plan
                </button>
                <p id="vlanError" class="text-red-500 text-sm mt-2 hidden"></p>
            </div>

            <div id="vlanResults" class="hidden space-y-6">
                <!-- Summary Card -->
                <div class="bg-white dark:bg-card rounded-xl shadow-md p-5 border-l-4 border-primary">
                    <h3 class="text-lg font-semibold mb-2">Résumé du Plan</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div><span class="text-gray-500 block">Nouveau Masque</span><span id="vlanNewMask" class="font-mono font-bold"></span></div>
                        <div><span class="text-gray-500 block">Block Size</span><span id="vlanBlockSize" class="font-mono"></span></div>
                        <div><span class="text-gray-500 block">Hôtes/VLAN</span><span id="vlanHostsCount" class="font-mono"></span></div>
                        <div><span class="text-gray-500 block">Total Utilisé</span><span id="vlanTotalUsed" class="font-mono"></span></div>
                    </div>
                </div>
                
                <!-- Table -->
                <div class="overflow-x-auto bg-white dark:bg-card rounded-xl shadow-md border border-gray-200 dark:border-slate-700">
                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-slate-700 dark:text-gray-400">
                            <tr>
                                <th class="px-4 py-3">VLAN ID</th>
                                <th class="px-4 py-3">Sous-Réseau</th>
                                <th class="px-4 py-3">Plage Utilisable</th>
                                <th class="px-4 py-3">Passerelle (1ère IP)</th>
                                <th class="px-4 py-3">Broadcast</th>
                                <th class="px-4 py-3 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="vlanTableBody">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Actions -->
                <div class="flex flex-wrap gap-4">
                    <button onclick="exportCSV()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Export CSV
                    </button>
                    <button onclick="copyCisco()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>
                        Copier Config Cisco
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="fixed bottom-5 right-5 bg-dark text-white px-6 py-3 rounded-lg shadow-2xl transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2">
        <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
        <span>Copié dans le presse-papier !</span>
    </div>

    <!-- FOOTER -->
    <footer class="bg-white dark:bg-dark border-t border-gray-200 dark:border-slate-700 py-8 mt-auto">
        <div class="max-w-7xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <p class="text-gray-500 text-sm">
                &copy; <span id="year"></span> IP Calc. Made by <span class="font-bold text-primary">Anis Guechetouli</span>.
            </p>
            <a href="#" onclick="window.open(GITHUB_URL, '_blank')" class="flex items-center gap-2 text-gray-500 hover:text-primary transition-colors text-sm">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                Voir sur GitHub
            </a>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- THEME MANAGEMENT ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const darkIcon = document.getElementById('theme-toggle-dark-icon');
        const lightIcon = document.getElementById('theme-toggle-light-icon');

        function initTheme() {
            if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
                lightIcon.classList.remove('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                darkIcon.classList.remove('hidden');
            }
        }

        themeToggleBtn.addEventListener('click', function() {
            darkIcon.classList.toggle('hidden');
            lightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });

        // --- GENERAL UI ---
        document.getElementById('year').textContent = new Date().getFullYear();
        
        // Populate CIDR Dropdown
        const cidrSelect = document.getElementById('cidrSelect');
        function populateCIDR(isV6 = false) {
            const currentVal = cidrSelect.value;
            cidrSelect.innerHTML = '';
            const max = isV6 ? 128 : 32;
            const def = isV6 ? 64 : 24;
            for(let i = 1; i <= max; i++) {
                const opt = document.createElement('option');
                opt.value = i;
                opt.text = `/${i}`;
                if(i === def) opt.selected = true;
                cidrSelect.appendChild(opt);
            }
            // Try to restore value if valid
            if(currentVal && parseInt(currentVal) <= max) cidrSelect.value = currentVal;
        }
        populateCIDR(false); // Default IPv4

        // --- TABS LOGIC ---
        function switchTab(tab) {
            const tabCalc = document.getElementById('tab-calc');
            const tabVlan = document.getElementById('tab-vlan');
            const btnCalc = document.getElementById('btn-tab-calc');
            const btnVlan = document.getElementById('btn-tab-vlan');

            if(tab === 'calc') {
                tabCalc.classList.remove('hidden');
                tabVlan.classList.add('hidden');
                btnCalc.classList.replace('text-gray-600', 'text-white');
                btnCalc.classList.replace('bg-white', 'bg-primary'); // Simplified class swap logic
                btnCalc.className = "px-6 py-2 rounded-md text-sm font-semibold bg-primary text-white shadow-sm transition-all";
                btnVlan.className = "px-6 py-2 rounded-md text-sm font-semibold text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-white transition-all";
            } else {
                tabCalc.classList.add('hidden');
                tabVlan.classList.remove('hidden');
                btnVlan.className = "px-6 py-2 rounded-md text-sm font-semibold bg-primary text-white shadow-sm transition-all";
                btnCalc.className = "px-6 py-2 rounded-md text-sm font-semibold text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-white transition-all";
            }
        }

        // --- CALCULATOR LOGIC ---
        const ipInput = document.getElementById('ipInput');
        
        // Enhanced Input Listener (Auto-suggestion + Sync)
        ipInput.addEventListener('input', (e) => {
            const val = e.target.value.trim();
            const isV6 = val.includes(':');
            
            // 1. Detect V4/V6 for Dropdown population
            if(isV6 && cidrSelect.options.length === 32) populateCIDR(true);
            if(!isV6 && cidrSelect.options.length === 128) populateCIDR(false);

            // 2. Check for explicit CIDR in input
            if(val.includes('/')) {
                const parts = val.split('/');
                const prefix = parseInt(parts[1]);
                if(!isNaN(prefix)) {
                    // Validate range
                    const max = isV6 ? 128 : 32;
                    if(prefix >= 0 && prefix <= max) cidrSelect.value = prefix;
                }
            } else {
                // 3. Auto-suggest
                if(isV6) {
                    cidrSelect.value = (val === '::1') ? 128 : 64;
                } else {
                    // IPv4 Auto-suggest logic
                    const firstOctet = parseInt(val.split('.')[0]);
                    if(!isNaN(firstOctet)) {
                        if(firstOctet === 10) cidrSelect.value = 8;
                        else if(firstOctet === 172) {
                            const second = parseInt(val.split('.')[1]);
                            if(!isNaN(second) && second >= 16 && second <= 31) cidrSelect.value = 12;
                            else cidrSelect.value = 24; 
                        }
                        else if(firstOctet === 192 && parseInt(val.split('.')[1]) === 168) cidrSelect.value = 16;
                        else if(firstOctet === 127) cidrSelect.value = 8;
                        else if(firstOctet === 169 && parseInt(val.split('.')[1]) === 254) cidrSelect.value = 16;
                        else cidrSelect.value = 24;
                    }
                }
            }
            
            // Recalculate automatically
            calculate(); 
        });

        // Trigger calculation on Enter
        ipInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') calculate();
        });

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // Helper: IP to Long (IPv4)
        function ip2long(ip) {
            let components;
            if(ip.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)) {
                components = ip.split('.');
            } else {
                return false;
            }
            let res = 0;
            for(let i=0; i<4; i++) {
                res = res * 256 + parseInt(components[i]);
            }
            return res;
        }

        // Helper: Long to IP (IPv4)
        function long2ip(long) {
            long = long >>> 0; 
            return [long>>>24, (long>>>16)&255, (long>>>8)&255, long&255].join('.');
        }

        // Helper: Binary String with dots
        function toBinary(long) {
            long = long >>> 0;
            let bin = long.toString(2).padStart(32, '0');
            return bin.match(/.{1,8}/g).join('.');
        }

        function calculate() {
            const rawInput = ipInput.value.trim();
            const errorMsg = document.getElementById('errorMsg');
            const resultsArea = document.getElementById('resultsArea');
            const osintCard = document.getElementById('osintCard');
            
            errorMsg.classList.add('hidden');
            resultsArea.classList.add('hidden');
            osintCard.classList.add('hidden');

            if(!rawInput) return;

            // Parse Input (Split CIDR if present)
            let ip = rawInput;
            let cidr = parseInt(cidrSelect.value);
            
            if(rawInput.includes('/')) {
                const parts = rawInput.split('/');
                ip = parts[0];
                // CIDR is already handled by input listener syncing the dropdown
            }

            // --- IPv4 LOGIC ---
            if(ip.includes('.') && !ip.includes(':')) {
                const ipLong = ip2long(ip);
                if(ipLong === false) {
                    errorMsg.textContent = "Adresse IPv4 invalide.";
                    errorMsg.classList.remove('hidden');
                    return;
                }

                // Calculations
                const maskLong = ~((1 << (32 - cidr)) - 1);
                const wildcardLong = ~maskLong;
                const netLong = ipLong & maskLong;
                const broadcastLong = netLong | wildcardLong;
                
                const totalHosts = Math.pow(2, 32 - cidr);
                const usableHosts = totalHosts - 2 > 0 ? totalHosts - 2 : 0;

                // Render Text
                document.getElementById('resIp').textContent = ip;
                document.getElementById('resMask').textContent = `${long2ip(maskLong)} (/${cidr})`;
                document.getElementById('resNetId').textContent = long2ip(netLong);
                document.getElementById('resBroadcast').textContent = long2ip(broadcastLong);
                document.getElementById('resWildcard').textContent = long2ip(wildcardLong);
                
                document.getElementById('resHosts').textContent = usableHosts.toLocaleString();
                document.getElementById('resTotal').textContent = totalHosts.toLocaleString();
                
                // Range
                if(cidr >= 31) {
                    document.getElementById('resFirst').textContent = "N/A (PtP)";
                    document.getElementById('resLast').textContent = "N/A";
                } else {
                    document.getElementById('resFirst').textContent = long2ip(netLong + 1);
                    document.getElementById('resLast').textContent = long2ip(broadcastLong - 1);
                }

                // Class & Type
                const firstOctet = parseInt(ip.split('.')[0]);
                let ipClass = 'A';
                if(firstOctet >= 128) ipClass = 'B';
                if(firstOctet >= 192) ipClass = 'C';
                if(firstOctet >= 224) ipClass = 'D (Multicast)';
                if(firstOctet >= 240) ipClass = 'E (Réservé)';

                let type = "Public";
                // Private ranges (RFC1918)
                if(firstOctet === 10) type = "Privé (RFC1918)";
                else if(firstOctet === 172 && parseInt(ip.split('.')[1]) >= 16 && parseInt(ip.split('.')[1]) <= 31) type = "Privé (RFC1918)";
                else if(firstOctet === 192 && parseInt(ip.split('.')[1]) === 168) type = "Privé (RFC1918)";
                else if(firstOctet === 127) type = "Loopback";
                else if(firstOctet === 169 && parseInt(ip.split('.')[1]) === 254) type = "Link-Local";

                // Role
                if(ipLong === netLong) type += " - ID Réseau";
                else if(ipLong === broadcastLong) type += " - Broadcast";
                else type += " - Hôte";

                document.getElementById('resClass').textContent = ipClass;
                document.getElementById('resType').textContent = type;

                // Binary
                document.getElementById('binIp').textContent = toBinary(ipLong);
                document.getElementById('binMask').textContent = toBinary(maskLong);

                // PTR
                const parts = ip.split('.');
                document.getElementById('resPtr').textContent = `${parts[3]}.${parts[2]}.${parts[1]}.${parts[0]}.in-addr.arpa`;

                resultsArea.classList.remove('hidden');

                // OSINT Call (Only if Public IPv4)
                if(type.includes("Public")) {
                    fetchOsint(ip);
                }

            } 
            // --- IPv6 LOGIC (Basic) ---
            else if (ip.includes(':')) {
                document.getElementById('resIp').textContent = ip;
                document.getElementById('resMask').textContent = `/${cidr}`;
                document.getElementById('resNetId').textContent = "Calcul complexe (IPv6)";
                document.getElementById('resBroadcast').textContent = "N/A (IPv6)";
                document.getElementById('resWildcard').textContent = "N/A";
                document.getElementById('resHosts').textContent = "2^" + (128-cidr);
                document.getElementById('resTotal').textContent = "2^" + (128-cidr);
                document.getElementById('resFirst').textContent = ip + " (Prefix)";
                document.getElementById('resLast').textContent = "Calcul complexe";
                document.getElementById('resClass').textContent = "IPv6";
                document.getElementById('resType').textContent = "IPv6 Unicast";
                document.getElementById('binIp').textContent = "Affichage binaire trop long";
                document.getElementById('binMask').textContent = "Prefix /" + cidr;
                document.getElementById('resPtr').textContent = "ip6.arpa (calcul complexe)";
                
                resultsArea.classList.remove('hidden');
            } else {
                errorMsg.textContent = "Format IP non reconnu.";
                errorMsg.classList.remove('hidden');
            }
        }

        async function fetchOsint(ip) {
            const osintCard = document.getElementById('osintCard');
            const content = document.getElementById('osintContent');
            
            osintCard.classList.remove('hidden');
            content.innerHTML = '<div class="col-span-4 text-center text-gray-500">Chargement des données OSINT...</div>';

            try {
                const response = await fetch(`https://ipwho.is/${ip}`);
                const data = await response.json();

                if(!data.success) {
                    content.innerHTML = `<div class="col-span-4 text-red-500">Erreur API: ${data.message}</div>`;
                    return;
                }

                content.innerHTML = `
                    <div>
                        <span class="block text-xs text-gray-500 uppercase">Pays</span>
                        <span class="font-semibold flex items-center gap-2">
                            <img src="${data.flag.img}" class="w-5 h-auto shadow-sm" alt="flag"> ${data.country}
                        </span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500 uppercase">Ville</span>
                        <span class="font-semibold">${data.city}</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500 uppercase">FAI (ISP)</span>
                        <span class="font-semibold">${data.connection.isp}</span>
                    </div>
                    <div>
                        <span class="block text-xs text-gray-500 uppercase">ASN</span>
                        <span class="font-semibold">AS${data.connection.asn}</span>
                    </div>
                `;

            } catch (e) {
                content.innerHTML = '<div class="col-span-4 text-red-500">Impossible de contacter l\'API OSINT.</div>';
            }
        }

        // --- VLAN PLANNER LOGIC ---
        function toggleVlanInputs() {
            const mode = document.getElementById('vlanMode').value;
            const divHosts = document.getElementById('divVlanHosts');
            if(mode === 'hosts') divHosts.classList.remove('hidden');
            else divHosts.classList.add('hidden');
        }

        let vlanDataCache = []; // Store for export

        function calculateVLAN() {
            const baseInput = document.getElementById('vlanBase').value.trim();
            const mode = document.getElementById('vlanMode').value;
            const count = parseInt(document.getElementById('vlanCount').value);
            const hosts = parseInt(document.getElementById('vlanHosts').value);
            const idsInput = document.getElementById('vlanIds').value.trim();
            const errorMsg = document.getElementById('vlanError');
            const results = document.getElementById('vlanResults');

            errorMsg.classList.add('hidden');
            results.classList.add('hidden');

            // Parse Base
            let baseIp = baseInput;
            let baseCidr = 24;
            if(baseInput.includes('/')) {
                const parts = baseInput.split('/');
                baseIp = parts[0];
                baseCidr = parseInt(parts[1]);
            } else {
                errorMsg.textContent = "Veuillez spécifier le CIDR du réseau de base (ex: /24).";
                errorMsg.classList.remove('hidden');
                return;
            }

            const baseLong = ip2long(baseIp);
            if(baseLong === false) {
                errorMsg.textContent = "Adresse IP de base invalide.";
                errorMsg.classList.remove('hidden');
                return;
            }

            // Align Base Network
            const baseMaskLong = ~((1 << (32 - baseCidr)) - 1);
            const alignedBaseLong = baseLong & baseMaskLong;
            if(alignedBaseLong !== baseLong) {
                // Warning handled by just using the aligned one, maybe show toast?
                // For now we silently correct it as per standard tool behavior
            }

            // Calculate New Prefix
            let newCidr;
            if(mode === 'count') {
                const bitsNeeded = Math.ceil(Math.log2(count));
                newCidr = baseCidr + bitsNeeded;
            } else {
                const needed = hosts + 2; // Network + Broadcast
                const hostBits = Math.ceil(Math.log2(needed));
                newCidr = 32 - hostBits;
            }

            // Validation
            if(newCidr > 32) {
                errorMsg.textContent = "Impossible : pas assez d'espace dans le réseau de base.";
                errorMsg.classList.remove('hidden');
                return;
            }
            if(mode === 'hosts') {
                const subnetsAvailable = Math.pow(2, newCidr - baseCidr);
                if(count > subnetsAvailable) {
                    errorMsg.textContent = `Impossible : seulement ${subnetsAvailable} sous-réseaux possibles avec ${hosts} hôtes.`;
                    errorMsg.classList.remove('hidden');
                    return;
                }
            }

            // Generate Subnets
            const blockSize = Math.pow(2, 32 - newCidr);
            const vlanIds = idsInput ? idsInput.split(',').map(s => s.trim()) : [];
            
            let currentNet = alignedBaseLong;
            let html = '';
            vlanDataCache = [];

            for(let i = 0; i < count; i++) {
                const vlanId = vlanIds[i] || (10 + i * 10);
                const broadcast = currentNet + blockSize - 1;
                const first = currentNet + 1;
                const last = broadcast - 1;
                
                const netStr = long2ip(currentNet);
                const maskStr = long2ip(~((1 << (32 - newCidr)) - 1));
                const broadStr = long2ip(broadcast);
                const firstStr = (newCidr >= 31) ? "N/A" : long2ip(first);
                const lastStr = (newCidr >= 31) ? "N/A" : long2ip(last);
                const rangeStr = (newCidr >= 31) ? "PtP" : `${firstStr} - ${lastStr}`;

                // Cache for export
                vlanDataCache.push({
                    id: vlanId,
                    cidr: newCidr,
                    mask: maskStr,
                    network: netStr,
                    broadcast: broadStr,
                    gateway: firstStr,
                    range: rangeStr
                });

                html += `
                <tr class="bg-white border-b dark:bg-card dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-800">
                    <td class="px-4 py-3 font-medium text-gray-900 dark:text-white">${vlanId}</td>
                    <td class="px-4 py-3 font-mono text-primary">${netStr}/${newCidr}</td>
                    <td class="px-4 py-3 font-mono text-xs">${rangeStr}</td>
                    <td class="px-4 py-3 font-mono text-xs select-all">${firstStr}</td>
                    <td class="px-4 py-3 font-mono text-xs text-gray-400">${broadStr}</td>
                    <td class="px-4 py-3 text-right">
                        <button onclick="navigator.clipboard.writeText('${netStr}/${newCidr}');showToast()" class="text-primary hover:text-secondary text-xs font-bold">Copier</button>
                    </td>
                </tr>
                `;

                currentNet += blockSize;
            }

            // Update UI
            document.getElementById('vlanNewMask').textContent = `/${newCidr}`;
            document.getElementById('vlanBlockSize').textContent = blockSize;
            document.getElementById('vlanHostsCount').textContent = (blockSize - 2 > 0) ? blockSize - 2 : 0;
            document.getElementById('vlanTotalUsed').textContent = `${count} / ${Math.pow(2, newCidr - baseCidr)}`;
            document.getElementById('vlanTableBody').innerHTML = html;
            
            results.classList.remove('hidden');
            
            // Re-init copy listeners for new elements
            document.querySelectorAll('.select-all').forEach(el => {
                el.style.cursor = 'pointer';
                el.title = 'Cliquer pour copier';
                el.addEventListener('click', () => {
                    navigator.clipboard.writeText(el.textContent);
                    showToast();
                });
            });
        }

        function exportCSV() {
            let csvContent = "data:text/csv;charset=utf-8,VLAN_ID,CIDR,MASK,NETWORK,BROADCAST,GATEWAY,RANGE\n";
            vlanDataCache.forEach(row => {
                csvContent += `${row.id},/${row.cidr},${row.mask},${row.network},${row.broadcast},${row.gateway},"${row.range}"\n`;
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "vlan_plan.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyCisco() {
            let config = "";
            vlanDataCache.forEach(row => {
                config += `interface vlan ${row.id}\n`;
                config += ` ip address ${row.gateway} ${row.mask}\n`;
                config += ` no shutdown\n!\n`;
            });
            navigator.clipboard.writeText(config);
            showToast();
        }

        // Init
        initTheme();
    </script>
</body>
</html>
